<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SS Weight Calculator</title>
    <link rel="manifest" href="manifest.json">
    <link rel="shortcut icon" href="icons/icon-192x192.png" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- bootstrap icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.47"></script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: Arial, sans-serif;
            --theme-color: #096f15;
            --theme-color2: #00c8ff;
        }
        .theme-color, .tc {
            color: var(--theme-color);
        }
        .b-tc {
            border-color: var(--theme-color);
        }
        .bg-tc {
            background-color: var(--theme-color);
        }
        .bg-tc2 {
            background-color: var(--theme-color2);
        }

        .container {
            max-width: 500px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .shape-option, .material-option {
            font-size: 1.2rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 5px;
            text-align: center;
            flex: 1;
            border: 1px solid transparent;
        }
        .material-option {
            font-size: .9rem;
        }
        .shape-name {
            font-size: 12px; 
            line-height: 1;
        }
        .shape-option.active, .material-option.active {
            border-color: #00c8ff57;
            box-shadow: 0 0 5px #00c8ff57;
            border-color: var(--theme-color2);
            
            background: #8a9cffd3;  
            background: #096f15a1;
            color: rgb(0, 0, 0);
        }
        .btn-lg {
            font-size: 1.25rem;
            padding: 12px;
            width: 100%;
            border-radius: 10px;
        }
        #installApp {
            display: none;
        }
    </style>
</head>
<body>
    <h2 class="text-center mt-2">Stainless Steel Weight Calculator</h2>

<div class="" id="app">
    <button id="installApp" class="btn btn-success btn-md mx-auto mb-3" onclick="installPWA()"> <i class="fas fa-download"></i> Download App</button>
    <div class="container b-tc">

        <div class="mt-3">
            <div class="d-flex gap-2 input-group">
                <div @click="shape = 'rod'" class="shape-option" :class="{active: shape === 'rod'}">
                    <i class="fas fa-circle"></i> 
                    <br> <span class="shape-name">Rod</span>
                </div>
                <div @click="shape = 'rect'" class="shape-option" :class="{active: shape === 'rect'}">
                    <i class="fas fa-square"></i> 
                    <br><span class="shape-name">Rect Bar</span>
                </div>                
                <div @click="shape = 'pipe'" class="shape-option" :class="{active: shape === 'pipe'}">
                    <i class="far fa-circle"></i> 
                    <br> <span class="shape-name">Pipe</span>
                </div>
                <div @click="shape = 'square_pipe'" class="shape-option" :class="{active: shape === 'square_pipe'}">
                    <i class="far fa-square"></i> 
                    <br> <span class="shape-name">Square Pipe</span>
                </div>
            </div>
        </div>

        <div class="mt-3">
            <div class="d-flex gap-5 input-group">
                <div @click="material = 'ss304'" class="material-option " :class="{active: material === 'ss304'}">SS304</div>
                <div @click="material = 'ss316'" class="material-option" :class="{active: material === 'ss316'}">SS316</div>
            </div>
        </div>

        <hr>
        <div class="mt-3" v-if="shape !== ''">
            <label class="form-label w-100">Enter Dimensions (mm)
                <span class="ms-1 fw-bold" v-if="weight !== null">{{ weight.toFixed(2) }}<span class="text-muted">0</span> kg</span>
                <button class="btn btn-sm btn-warning border-warning-subtle  float-end btn-md" @click="reset"> <i class="fas fa-trash"></i></button>
            </label>
            <Bsig text="Ø" v-if="shape === 'rod'" >
                <input type="number" class="form-control" v-model.number="diameter" placeholder="Diameter">
            </Bsig>
            <!-- <input v-if="shape === 'rod'" type="number" class="form-control" v-model.number="diameter" placeholder="Diameter"> -->
            <div v-if="shape === 'pipe'" class="">
                <Bsig text="OD">
                    <input type="number" class="form-control" v-model.number="outerDiameter" placeholder="Outer Diameter">
                </Bsig>
                <Bsig text="Thickness">
                <input type="number" class="form-control" v-model.number="thickness" placeholder="Wall Thickness">
                </Bsig>
            </div>
            <div v-if="shape === 'square_pipe'" class="">
                <input type="number" class="form-control" v-model.number="width" placeholder="OD">
                <Bsig text="Thickness">
                <input type="number" class="form-control" v-model.number="thickness" placeholder="Wall Thickness">
                </Bsig>
            </div>
            <div v-if="shape === 'rect'" class="d-flex gap-2">
                <input type="number" class="form-control" v-model.number="width" placeholder="Width">
                <i class="bi bi-x"></i>
                <input type="number" class="form-control" v-model.number="height" placeholder="Height">
            </div>
            <input type="number" class="form-control mt-2" v-model.number="length" placeholder="Length">
        </div>
    </div>

    <div id="result" class="card bg-tc2 my-4 mx-auto " style="max-width: 500px;">
        <div class="mt-3 text-center fw-bold " v-if="weight !== null">
            <h4>Estimated Weight: {{ weight.toFixed(2) }}<span class="text-muted">0</span> kg</h4>
        </div>
        <div class="text-center mt-2" v-if="weight !== null">

            <p v-if="shape && material" class="m-1"><span>{{ material.toUpperCase() }}</span> | <span>{{ shape.charAt(0).toUpperCase() + shape.slice(1) }}</span></p>
            <p id="dimentions">
                <span v-if="shape === 'rod'">Ø {{ diameter }} </span>
                <span v-if="shape === 'pipe'">OD: {{ outerDiameter }} <i class="bi bi-x mx-1"></i> Thickness {{ thickness }} </span>
                <span v-if="shape === 'rect'"> {{ width }} <i class="bi bi-x mx-1"></i> {{ height }}</span>
                <span v-if="shape === 'square_pipe'">{{ width }} <i class="bi bi-x mx-1"></i>{{ thickness }} </span>
                <i class="bi bi-x mx-1"></i> {{ length }} (mm)
            </p>
            <button class="btn btn-sm btn-success btn-md mb-2 mx-auto" @click="save"> <i class="fas fa-save"></i> save</button>

        </div>



    </div>

    <div class="history mb-5">
        <h2 class="text-center mt-2">History</h2>
        <ul class="list-group">
            <li class="list-group-item" v-for="(item, index) in history" :key="item.id">
                <div class="d-flex justify-content-between">
                    <p><span>{{ item.material.toUpperCase() }} 
                        | {{ item.shape.charAt(0).toUpperCase() + item.shape.slice(1) }} 
                        | {{ item.dimentions }} = {{ item.weight }} kg </span>
                        <br>
                        <small class="text-muted">{{ item.time }}</small></p>
                    <div class="d-flex gap-2">
                        <button class="btn text-danger" @click="deleteItem(index)"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            </li>

        </ul>
    </div>
    <footer class="text-center mt-3">
        <p>&copy; 2025 Dev. All rights reserved.</p>
    </footer>    
    <div class="text-center sticky-bottom bg-dark-subtle">
        <button class="btn   btn-md w-50 btn-success " @click="showResult">Calculate Weight</button>
        <button class="btn btn-success btn-md m-1" @click="save"> <i class="fas fa-save"></i></button>
    </div>

</div> 
<!-- app -->


    <script>
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            // e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installApp').style.display = 'block';
        });
        function installPWA() {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then(() => {
                document.getElementById('installApp').style.display = 'none';
            });
        }

        const Muted = {
            template: '<span class="text-muted mx-1"><slot></slot></span>',
            name: 'Muted'
        };
        const Bsig = {
            //bootstrap input group
            props: ['text', 'fa'],
            template : `<div class="input-group my-1">
                            <span class="input-group-text">
                                <template v-if="fa"><i :class="'fas fa-' + fa"></i></template>
                                <template v-else-if="text">{{ text }}</template>
                            </span>
                            <slot></slot>
                        </div>`,
            name: 'Bsig' 
        }
        const X = {
            template : `<span class="text-muted mx-1"><i class="bi bi-x"></i></span>`,
            name: 'X'
        }

        const app = Vue.createApp({
            data() {
                return {
                    shape: 'rod',
                    material: 'ss304',
                    diameter: null,
                    outerDiameter: null,
                    thickness: null,
                    width: null,
                    height: null,
                    length: null,
                    weight: null,
                    history: [],
                    dimentions: null
                    
                };
            },
            components: {
                Muted,
                Bsig,
                X
            },
            computed: {
                density() {
                    return this.material === 'ss304' ? 8000 : 7980;
                }
            },
            watch: {
                material() {
                    this.calculateWeight(); // Live calculation when material changes
                },
                shape() {
                    this.weight = this.calculateWeight(); // Reset weight when shape changes
                },
                diameter() {
                    this.calculateWeight(); // Live calculation when diameter changes
                },
                outerDiameter() {
                    this.calculateWeight(); // Live calculation when outer diameter changes
                },
                thickness() {
                    this.calculateWeight(); // Live calculation when wall thickness changes
                },
                width() {
                    this.calculateWeight(); // Live calculation when width changes
                },
                height() {
                    this.calculateWeight(); // Live calculation when height changes
                },
                length() {
                    this.calculateWeight(); // Live calculation when length changes
                }
            },
            methods: {
                calculateWeight() {
                    let volume = 0;
                    if (this.shape === 'rod' && this.diameter && this.length) {
                        let radius = this.diameter / 2 / 1000;
                        volume = Math.PI * Math.pow(radius, 2) * (this.length / 1000); // Volume in m^3
                        this.dimentions = "Ø " + this.diameter + " x " + this.length + " mm";
                    } else if (this.shape === 'pipe' && this.outerDiameter && this.thickness && this.length) {
                        let outerRadius = this.outerDiameter / 2 / 1000;
                        let innerRadius = (this.outerDiameter - 2 * this.thickness) / 2 / 1000;
                        volume = Math.PI * (Math.pow(outerRadius, 2) - Math.pow(innerRadius, 2)) * (this.length / 1000); // Volume in m^3
                        this.dimentions = "OD " + this.outerDiameter + " x " + this.thickness + " x " + this.length + " mm";
                    } else if (this.shape === 'rect' && this.width && this.height && this.length) {
                        volume = (this.width / 1000) * (this.height / 1000) * (this.length / 1000); // Volume in m^3
                        this.dimentions = this.width + " x " + this.height + " x " + this.length + " mm";
                    } else if (this.shape === 'square_pipe' && this.width && this.thickness && this.length) {
                        let outerArea = (this.width / 1000) ** 2; 
                        let innerWidth = this.width - 2 * this.thickness;
                        let innerArea = (innerWidth / 1000) ** 2;
                        volume = (outerArea - innerArea) * (this.length / 1000);
                        this.dimentions = this.width + " x " + this.thickness + " x " + this.length + " mm";
                    }

                    this.weight =  volume * this.density; // Weight in kg
                    if (this.weight <=0 ) {
                        this.weight = null;
                    } else if (this.weight < 0) {
                        alert("Invalid Input.");
                    }
                    return this.weight;
                },
                save() {
                    var weight = this.weight;
                    if (weight === null || weight <= 0) {
                        alert("Please calculate the weight first.");
                        return;
                    }                    
                    weight = this.weight.toFixed(2); // Round weight to 2 decimal places
                    const date = new Date().toLocaleString('en-GB', {
                        day: '2-digit',
                        month: 'short',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: true,
                    }); // Get current date and time in DD-MMM-YYYY HH:MM:SS

                    console.log(date);



                    const data = {
                        id: Date.now(),
                        weight: weight,
                        time: date,
                        material: this.material,
                        shape: this.shape,
                        dimentions : this.dimentions
                    };
                    let history = JSON.parse(localStorage.getItem('history')) || [];
                    history.push(data);
                    localStorage.setItem('history', JSON.stringify(history));
                    this.loadHistory();
                },
                reset() {
                    this.shape = 'rod';
                    this.material = 'ss304';
                    this.diameter = null;
                    this.outerDiameter = null;
                    this.thickness = null;
                    this.width = null;
                    this.height = null;
                    this.length = null;
                    this.weight = null;
                },
                loadHistory() {
                    var history = JSON.parse(localStorage.getItem('history')) || [];
                    //reverse the history array
                    this.history = history.reverse();
                    console.log('history',this.history)
                },
                deleteItem(id) {
                    console.log(id);
                    
                    this.history = this.history.filter((item, index) => index !== id);
                    localStorage.setItem('history', JSON.stringify(this.history));
                },
                showResult() {
                    var w = this.calculateWeight();
                    if (!w) {
                        //focus the first visible field
                        $('input:visible').first().focus();
                        return;
                    }
                    //scroll to the result section
                    document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
                }

            },
            mounted() {
                this.loadHistory();
            }
                
            
        });
        app.mount('#app');
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(() => console.log("Service Worker Registered"));
        }
    </script>
    
</body>
</html>
